<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<style>
  body {
    padding: 100px;
    width: 1000px;
    margin: auto;
    text-align: left;
    font-weight: 300;
    font-family: 'Open Sans', sans-serif;
    color: #121212;
  }
  h1, h2, h3, h4 {
    font-family: 'Source Sans Pro', sans-serif;
  }
</style>
<title>CS 184 Mesh Editor</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link href="https://fonts.googleapis.com/css?family=Open+Sans|Source+Sans+Pro" rel="stylesheet">
<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/latest.js?config=TeX-MML-AM_CHTML' async></script>
</head>


<body>

<h1 align="middle">CS 184: Computer Graphics and Imaging, Spring 2018</h1>
<h1 align="middle">Final Project: Position Based Fluids</h1>
<h2 align="middle">Anna Brewer, Reginal Ongowarsito, Yining Chen</h2>

<!-- <br><br> -->

<h2 align="middle">Technical Approach</h2>
<p> We referenced <a href="http://mmacklin.com/pbf_sig_preprint.pdf">this</a> paper when implementing our fluid simulation. It modfies the SPH (Smoothed Particle Hydrodynamics) method for particle-based fluid simulation, using the unconditionally stable PBD (Position Based Dynamics) framework to facilitate real-time applications. It also modifies PBD by replacing Gauss-Seidel iteration with Jacobi iteration. In this method, we have one constraint equation for each particle, based on the positions of all other particles. We have a set of initial positions of the particles, and in each time step we iteratively update each particle's position individually by plugging the positions of the rest of the particles from the last time step into its constraint equation. Here we provide a simplified overview of the method outlined in the paper. </p>
<p>
We get the constraints using the ratio between the SPH density estimator \(p_i\) and the rest density \(p_0\). We want the density of the fluid to stay close to the rest density, so the particles should move in a way that brings this ratio closer to 1. Each particle's constraint (which is a function of the position of all the other particles) is the difference between the current ratio and the ideal ratio of 1:
$$ \frac{p_i}{p_0} - C_i(p_1...p_n) = 1 $$</p>

<p>The SPH density estimator \(p_i\) is defined as follows: 
$$ p_i = \sum_{j}W(p_i - p_j, h) $$</p>
<p>\(W\) represents the weight function, which defines how much the effect of each particle \(p_j\) on the current particle \(p_i\) decreases as a function of their distance \(p_i - p_j\) . In this case, we are using the Poly6 kernel, which looks similar to a Gaussian distribution. </p>

<p>We're looking for a particle position correction \(\Delta p\) such that \(C(p + \Delta p) = 0\), meaning the particle has moved such that \(\frac{p_i}{p_0} = 1\). </p>

<p>We know that \(\Delta p = \nabla C(p)\lambda\), where \(\Delta C\) is the gradient of \(C\) (roughly, the vector direction the particle should be moving in) and \(\lambda\) is a scaling factor. Using a series of Newton steps along the gradient, we have 
    $$ (C(p + \Delta p)) \approx C(p) + \nabla C^T \nabla C \lambda $$
</p>
<p> We 

<h2 align="middle">Problems Encountered</h2>

<p>At first, we wanted to create a simulation using a library from a paper that we had read,  but it had only been tested on Windows and Ubuntu, and all three of us were using Macs. We tried to make it work for a while longer than we should have, and ultimately found that it may be more work than it would be worth. 
</p>

<p>From there, we pivoted our project to create a water simulation through webGL, in the hopes of also connecting on Leap Motion and Google Cardboard to make a water bending simulation. However, we found that Cardboard and Leap Motion could not work together, and had to leave in just the Leap Motion portion of our project. </p>

<p>For a portion of the project, we were very unsure if the reason for our simulation not acting like water due to errors in code, or in our parameters. After a bit of fiddling around, we tried to do a bit more research ourselves, and found a project from Stanford online, which was also based off the same Position Based Dynamics paper, and had parameters that were suggested by the author of the paper. This taught us to not only trust the internet a more in the debugging process by not always assuming that the problem has to do with our code, but also that we could potentially reach out to the authors of the papers for advice. </p>

<p>Another problem that we found was that our simulation would run incredibly slow, since it's running in a browser, but we overcame this by creating a caching system that calculates all of the position based dynamics beforehand, and then presents the simulation after. This not only made it easier for us to work on other aspects of the code while it was loading, but also it gave us a better idea of where our simulation was failing, since we could load simulations with more particles and still watch them at a regular rate.</p>



<h2 align="middle">Lessons Learned</h2>

<p>All three of us were surprised by how much we learned outside of coding. It took all of us a much longer time than expected truly understanding the paper that we based our code off of. As a result, we developed a better understanding on how to read code-related scientific papers, as well as a knack for figuring out how to connect the different parts of the equations together from older scientific papers. </p>
<p>Another more general life lesson we learned was not only to start earlier, but to properly commit to an idea. A lot of time was wasted trying to do a lot of things that none of us were fully committed to, kind of like a franken-project. Even during the last week we threw around the idea of converting our code to OpenGL to be able to speed up the process before we came up with our caching mechanism. </p>
<p> While ultimately, a waterbending VR leapmotion simulator would have been pretty incredible to implement and play with, we definitely underestimated</p>

<h2 align="middle">Results</h2>

<h2 align="middle">References</h2>
<a href="workplace.html">this</a>

<h2 align="middle">Contributions from each team member</h2>




</body>
</html>